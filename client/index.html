<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ColLab!!!</title>
    <link href="//cdn.quilljs.com/1.0.6/quill.snow.css" rel="stylesheet">
    <link rel="stylesheet" href="./style.css">
  </head>
  <body>
    <h1>ColLab!!!</h1>
    <div class="container">
      <div id="editor">
        <p>Type here</p>
      </div>
    </div>

    <div id="area" contentEditable="true"></div>
    <div id="app" />
    <script src="public/bundle.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="//code.jquery.com/jquery-1.11.1.js"></script>
    <script src="//cdn.quilljs.com/1.0.6/quill.min.js"></script>
    <script type="text/javascript">
    var user = 'user_' + Date.now(); // temp unique user identifier; swap out later with username
    console.log(user + ' logged on.');

    var $editor = $('#editor');

    var socket = io();

    var quill = new Quill('#editor', {
      theme: 'snow'
    });

    quill.on('text-change', function(delta, source) {
      // if (source === user) {
      console.log('delta:', delta);
      console.log('source:', source);
      console.log('emit change event user:', user);
      socket.emit('change', {'who': user, 'delta': JSON.stringify(delta)});
      // }
    });

    socket.on('change', function(msg){
      console.log('msg.who:', msg.who);
      console.log('user:', user);
      console.log(msg.who === user);
      console.log('msg:', msg)
      console.log('receive change event:', msg.who);
      if(msg.who !== user) { // prevent infinite loop; user who emitted msg should not receive it
        console.log('msg.who:', msg.who);
        console.log('user:', user);
        console.log(msg.who === user);

        var del = JSON.parse(msg.delta);
        // var Delta = fullEditor.getContents().constructor;
        // var delta = new Delta(del.startLength,del.endLength,del.ops);
        quill.updateContents( del, String = 'user' );
      }
    });

    </script>

  </body>
</html>
